{% extends "events/dashboard_base.html" %}

{% block sidebar %}
  <h6 class="text-uppercase mb-3 dashboard-sidebar-title text-dark">Attendee</h6>
  <ul class="nav flex-column gap-2 dashboard-sidebar-nav">
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'attendee_events' %}active{% endif %}"
        href="{% url 'events:attendee_events' %}">
        All events
      </a>
    </li>

    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'attendee_my_events' %}active{% endif %}"
        href="{% url 'events:attendee_my_events' %}">
        My registered events
      </a>
    </li>

    <li class="nav-item mt-3">
      <span class="nav-link text-dark p-0 ">Profile</span>
    </li>

    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'attendee_profile' %}active{% endif %}"
        href="{% url 'events:attendee_profile' %}">
        Edit profile
      </a>
    </li>
  </ul>
{% endblock %}

{% block main_content %}
  <div class="dashboard-banner mb-4">
    <h5 class="fw-bold fs-3 text-white">My Registered Events</h5>
    <p class="mb-0 text-white-50 small">Events you are currently participating in.</p>
  </div>

  {% if events %}
    <div class="event-row-cards">
      {% for e in events %}
        <div class="event-row-card panel-card p-3">
            <div class="event-card-image-wrapper">
            {% if e.image %}
                <img src="{{ e.image.url }}" alt="Event image" class="event-card-image">
            {% else %}
                <img src="/static/default.jpg" alt="No image available" class="event-card-image">
            {% endif %}
          </div>
          <div class="event-card-content">
            <div class="d-flex justify-content-between align-items-start mb-1">
              <div>
                <div class="fw-semibold">{{ e.title }}</div>
                <div class="text-muted small">
                  {{ e.date|date:"M d, Y" }} • {{ e.location }}
                </div>
                <div> <i class="bi bi-clock"></i> {{ e.start_time|time:"H:i" }} - {{ e.end_time|time:"H:i" }}</div>
                {% if e.location %}
                  <div class="small mb-1">
                    <i class="bi bi-geo-alt me-1"></i>{{ e.location }}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="small mb-1">
              ⭐ {{ e.avg_rating|default:"-" }}/5
              <span class="text-muted">({{ e.fb_count|default:0 }} reviews)</span>
            </div>

            <div class="mt-3 d-flex flex-wrap gap-2">

              <a class="btn btn-sm btn-outline-info rounded-pill"
                 href="{% url 'events:event_detail' e.id %}">
                Details
              </a>

              <a class="btn btn-sm btn-outline-primary rounded-pill"
                 href="{% url 'events:feedback_create' e.id %}">
                Give Feedback
              </a>

              <form method="post"
                    action="{% url 'events:attendee_leave_event' e.id %}"
                    class="d-inline">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger rounded-pill">
                  Cancel registration
                </button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      You have not registered for any events yet.
    </div>
  {% endif %}
{% endblock %}
