{% extends "events/dashboard_base.html" %}
{% block sidebar %}
  {% if request.user.is_superuser %}
    <h6 class="text-uppercase mb-3 dashboard-sidebar-title text-dark">Admin</h6>
    <ul class="nav flex-column gap-2 dashboard-sidebar-nav">

      <li class="nav-item">
        <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}"
          href="{% url 'events:admin_dashboard' %}">
          <i class="bi bi-house-door"></i> Dashboard
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'admin_review' %}active{% endif %}"
          href="{% url 'events:admin_review' %}">
          <i class="bi bi-ui-checks-grid"></i> Review submissions
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'admin_feedback_overview' %}active{% endif %}"
          href="{% url 'events:admin_feedback_overview' %}">
          <i class="bi bi-calendar-event"></i> All events
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'admin_user_management' %}active{% endif %}"
          href="{% url 'events:admin_user_management' %}">
          <i class="bi bi-people"></i> User management
        </a>
      </li>

    </ul>

  {% elif request.user.profile.role == 'organizer' %}
    <h6 class="text-uppercase mb-3 dashboard-sidebar-title text-dark">Organizer</h6>
  <ul class="nav flex-column gap-2 dashboard-sidebar-nav">
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'organizer_dashboard' %}active{% endif %}" href="{% url 'events:organizer_dashboard' %}">
        Dashboard
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'organizer_events' %}active{% endif %}" href="{% url 'events:organizer_events' %}">
        My events
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'event_create' %}active{% endif %}" href="{% url 'events:event_create' %}">
        Create event
      </a>
    </li>
    <li class="nav-item mt-3">
      <span class="nav-link text-dark p-0 ">Profile</span>
    </li>
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'organizer_profile' %}active{% endif %}" href="{% url 'events:organizer_profile' %}">
        Edit profile
      </a>
    </li>
  </ul>

  {% elif request.user.profile.role == 'attendee' %}
    <h6 class="text-uppercase mb-3 dashboard-sidebar-title text-dark">Attendee</h6>
    <ul class="nav flex-column gap-2 dashboard-sidebar-nav">

      <li class="nav-item">
        <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'attendee_events' %}active{% endif %}"
          href="{% url 'events:attendee_events' %}">
          All events
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'attendee_my_events' %}active{% endif %}"
          href="{% url 'events:attendee_my_events' %}">
          My registered events
        </a>
      </li>

      <li class="nav-item mt-3">
        <span class="nav-link text-dark p-0">Profile</span>
      </li>

      <li class="nav-item">
        <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'attendee_profile' %}active{% endif %}"
          href="{% url 'events:attendee_profile' %}">
          Edit profile
        </a>
      </li>

    </ul>
  {% endif %}

{% endblock %}

{% block main_content %}
<div class="event-detail-card p-4">

  <h3 class="fw-bold mb-1">{{ event.title }}</h3>
  
  <div class="text-muted small mb-3">
    {{ event.date|date:"M d, Y" }} • {{ event.location }}
  </div>

  <p class="mb-4">{{ event.short_description }}</p>

  {# Attendee Buttons #}
  {% if request.user.profile.role == 'attendee' %}
    <div class="d-flex gap-2 mb-4">
      {% if joined %}
        <a class="btn btn-primary btn-sm px-3"
           href="{% url 'events:feedback_create' event.id %}">
          Give Feedback
        </a>
      {% else %}
        <a class="btn btn-outline-secondary btn-sm px-3"
           href="{% url 'events:attendee_join_event' event.id %}">
          Join Event
        </a>
      {% endif %}
    </div>
  {% endif %}

  {# Organizer / Admin Participant List #}
  {% if request.user.is_superuser or request.user.profile.role == 'organizer' %}
    <hr class="my-4">

    <h5 class="fw-semibold mb-3">Participants ({{ participants|length }})</h5>

    {% if participants %}
      <ul class="list-group list-group-flush">
        {% for p in participants %}
          <li class="list-group-item event-participant-item">
            <strong>{{ p.user.get_full_name|default:p.user.username }}</strong>
            <span class="text-muted small">
              – joined {{ p.joined_at|date:"M d, Y H:i" }}
            </span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mt-2">No participants yet.</p>
    {% endif %}
  {% endif %}

</div>
{% endblock %}
