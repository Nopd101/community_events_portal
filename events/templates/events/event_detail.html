{% extends "events/dashboard_base.html" %}

{% block main_content %}
<a href="javascript:history.back()" class="btn btn-light bg-grad text-white mb-3" 
     style="border-radius: 1rem; padding: .45rem 1rem;">
    ← Back
  </a>
<div class="event-detail-card p-4">

  <h3 class="fw-bold mb-1">{{ event.title }}</h3>
  
  <div class="text-muted small mb-3">
    {{ event.date|date:"M d, Y" }} • {{ event.location }}
  </div>

  <p class="mb-4">{{ event.short_description }}</p>

  {# Attendee Buttons #}
  {% if request.user.profile.role == 'attendee' %}
    <div class="d-flex gap-2 mb-4">
      {% if joined %}
        <a class="btn btn-primary btn-sm px-3"
           href="{% url 'events:feedback_create' event.id %}">
          Give Feedback
        </a>
      {% else %}
        <a class="btn btn-outline-secondary btn-sm px-3"
           href="{% url 'events:attendee_join_event' event.id %}">
          Join Event
        </a>
      {% endif %}
    </div>
  {% endif %}

  {# Organizer / Admin Participant List #}
  {% if request.user.is_superuser or request.user.profile.role == 'organizer' %}
    <hr class="my-4">

    <h5 class="fw-semibold mb-3">Participants ({{ participants|length }})</h5>

    {% if participants %}
      <ul class="list-group list-group-flush">
        {% for p in participants %}
          <li class="list-group-item event-participant-item">
            <strong>{{ p.user.get_full_name|default:p.user.username }}</strong>
            <span class="text-muted small">
              – joined {{ p.joined_at|date:"M d, Y H:i" }}
            </span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mt-2">No participants yet.</p>
    {% endif %}
  {% endif %}

</div>
{% endblock %}
