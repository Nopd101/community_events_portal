{% extends "events/dashboard_base.html" %} {% block sidebar %}
  <h6 class="text-uppercase mb-3 dashboard-sidebar-title text-dark">Organizer</h6>
  <ul class="nav flex-column gap-2 dashboard-sidebar-nav">
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'organizer_dashboard' %}active{% endif %}" href="{% url 'events:organizer_dashboard' %}">
        <i class="bi bi-house-door"></i>Dashboard
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'organizer_events' %}active{% endif %}" href="{% url 'events:organizer_events' %}">
        <i class="bi bi-calendar-event"></i>My events
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'event_create' %}active{% endif %}" href="{% url 'events:event_create' %}">
        <i class="bi bi-plus-circle"></i>Create event
      </a>
    </li>
    <li class="nav-item mt-3">
      <span class="nav-link text-dark p-0 ">Profile</span>
    </li>
    <li class="nav-item">
      <a class="nav-link sidebar-pill-link {% if request.resolver_match.url_name == 'organizer_profile' %}active{% endif %}" href="{% url 'events:organizer_profile' %}">
        <i class="bi bi-people"></i>Edit profile
      </a>
    </li>
  </ul>
{% endblock %} 
{% block main_content %}
  <div class="dashboard-banner mb-4">
    <h5 class="fw-bold fs-3 text-white mb-1">
      {% if event %}Edit Event{% else %}Create Event{% endif %}
    </h5>
    <p class="text-white-50 small mb-0">
      Define your event details, upload an image, and save your changes.
    </p>
  </div>
<div class="card panel-card p-4 mb-4">
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for err in form.non_field_errors %}
          {{ err }}<br>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" novalidate>
      {% csrf_token %}

      <div class="row g-3">
        {% for field in form %}
          <div class="col-md-6">
            <div class="mb-2">
              <label class="form-label" for="{{ field.id_for_label }}">
                {{ field.label }}
                {% if field.field.required %}
                  <span class="text-danger">*</span>
                {% endif %}
              </label>
              {{ field }}

              {% if field.help_text %}
                <div class="form-text">{{ field.help_text }}</div>
              {% endif %}

              {% for error in field.errors %}
                <div class="invalid-feedback d-block">
                  {{ error }}
                </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="mt-3">
        <img
          id="image-preview"
          {% if form.instance.image %}
            src="{{ form.instance.image.url }}"
            style="max-width: 250px; max-height: 250px;"
          {% else %}
            style="max-width: 250px; max-height: 250px; display: none;"
          {% endif %}
          alt="Event image preview"
        />
      </div>

      <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary bg-grad">
          {% if event %}Update{% else %}Save{% endif %}
        </button>
        <a href="{% url 'events:organizer_events' %}" class="btn btn-outline-secondary">
          Cancel
        </a>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const input = document.getElementById("id_image");   // Django's default id
      const preview = document.getElementById("image-preview");

      if (!input || !preview) return;

      input.addEventListener("change", function (event) {
        const file = event.target.files[0];

        if (!file) {
          preview.style.display = "none";
          preview.src = "";
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      });
    });
  </script>
{% endblock %}
