{% extends "events/dashboard_base.html" %}

{% block sidebar %}
  <h6 class="text-uppercase text-white-50 mb-3">Admin</h6>
  <ul class="nav flex-column gap-2">
    <li class="nav-item">
      <a class="nav-link text-white p-0" href="{% url 'events:admin_dashboard' %}">
        Dashboard
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-white p-0" href="{% url 'events:admin_review' %}">
        Review submissions
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-white p-0" href="{% url 'events:admin_feedback_overview' %}">
        All events
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-white p-0" href="{% url 'events:admin_user_management' %}">
        User management
      </a>
    </li>
  </ul>
{% endblock %}

{% block main_content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>User Management</h5>
  </div>

    <form method="get" action="." class="row g-2 mb-3">
    <div class="col-sm-3">
      <select name="role" class="form-select">
        <option value="">All Roles</option>
        <option value="attendee"  {% if role_filter == "attendee" %}selected{% endif %}>Attendee</option>
        <option value="organizer" {% if role_filter == "organizer" %}selected{% endif %}>Organizer</option>
        <option value="admin"     {% if role_filter == "admin" %}selected{% endif %}>Admin</option>
      </select>
    </div>
    <div class="col-sm-4">
      <input type="text"
             name="q"
             class="form-control"
             placeholder="Search username, name or email…"
             value="{{ q }}">
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-primary">Filter</button>
    </div>
  </form>

  {% if users %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Username</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
            <tr>
              <td>{{ u.username }}</td>
              <td>{{ u.get_full_name|default:"—" }}</td>
              <td>{{ u.email|default:"—" }}</td>
              <td>
                {% if u.profile %}
                  {{ u.profile.role|title }}
                {% else %}
                  —
                {% endif %}
              </td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary"
                  href="{% url 'accounts:admin_user_edit' u.id %}">
                  Edit
                </a>
                <a class="btn btn-sm btn-outline-danger"
                  href="{% url 'accounts:admin_user_delete' u.id %}">
                  Delete
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">No users found.</div>
  {% endif %}
{% endblock %}
